<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <link rel="icon" type="image/png" href="icon.png">
    <title>About Us - TPA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <style>
         body { font-family: 'Inter', sans-serif; }
         .modal-bg { background-color: rgba(0,0,0,0.5); }
         .tab-button.active { border-color: #eab308; color: #eab308; }
         @keyframes pop {
             0% { transform: scale(1); }
             50% { transform: scale(1.3); }
             100% { transform: scale(1); }
         }
         .pop { animation: pop 0.2s ease-out; }
       
         .header-top-bar {
            background-color: #eab308;
            font-size: 0.7rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .header-top-bar a {
            transition: color 0.2s ease;
        }
        .header-top-bar a:hover {
            color: #f3f4f6;
        }
         .main-nav { background-color: #f3f4f6; border-bottom: 1px solid #e5e7eb; }
         
         .category-sidebar a { display: block; padding: 8px 16px; border-bottom: 1px solid #eee; }
         .category-sidebar a:hover { background-color: #f9fafb; color: #d97706; }
         .category-drawer a {
            display: block;
            padding: 12px 20px;
            text-transform: uppercase;
            font-size: 0.875rem;
            border-bottom: 1px solid #f3f4f6;
            color: #374151;
            transition: all 0.2s ease;
            font-weight: 500;
         }
         .category-drawer a:hover {
            background-color: #f9fafb;
            color: #d97706;
         }
         .category-drawer a.active-link {
            color: #eab308;
            font-weight: 700;
         }
         .category-drawer a i {
            display: none;
         }

         .category-sidebar h3, .category-drawer h3 { background-color: #eab308; color: white; padding: 12px 16px; }
         .category-sidebar h3, .category-drawer h3 { background-color: #eab308; color: white; padding: 12px 16px; }

         .drawer-tab.active {
            color: #eab308;
            border-bottom: 2px solid #eab308;
            font-weight: 600;
         }
         .drawer-menu-link {
            display: block;
            padding: 12px 20px;
            text-transform: uppercase;
            font-size: 0.875rem;
            border-bottom: 1px solid #f3f4f6;
            color: #374151;
            transition: all 0.2s ease;
         }
         .drawer-menu-link:hover {
            background-color: #f9fafb;
            color: #d97706;
         }
         .drawer-menu-link.active-link {
            color: #eab308;
            font-weight: 700;
         }
         .product-card {
             transition: all 0.3s ease;
             position: relative;
             overflow: hidden;
             border: 1px solid #e5e7eb;
             display: flex;
             flex-direction: column;
         }
         .product-card:hover {
             box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
             border-color: #eab308;
         }
         .product-card .product-image-container {
             position: relative;
             overflow: hidden;
             aspect-ratio: 1 / 1;
             display: flex;
             justify-content: center;
             align-items: center;
             width: 100%;
         }
         .product-card .product-image {
             width: 100%;
             height: 100%;
             max-width: 100%;
             max-height: 100%;
             object-fit: contain;
             mix-blend-mode: multiply;
         }
         .product-card .action-icons {
             position: absolute;
             top: 10px;
             left: 10px;
             display: flex;
             flex-direction: column;
             gap: 8px;
             z-index: 20;
             opacity: 0;
             transform: translateX(-20px);
             transition: all 0.3s ease-out;
         }
         .product-card:hover .action-icons {
             opacity: 1;
             transform: translateX(0);
         }
         .product-card .action-icons button, .product-card .action-icons a {
             background-color: white;
             border-radius: 50%;
             width: 36px;
             height: 36px;
             display: flex;
             align-items: center;
             justify-content: center;
             box-shadow: 0 2px 4px rgba(0,0,0,0.1);
             color: #374151;
             transition: all 0.2s ease;
         }
         .product-card .action-icons button:hover, .product-card .action-icons a:hover {
             background-color: #eab308;
             color: white;
         }
         .product-info-area {
             flex-grow: 1;
             display: flex;
             flex-direction: column;
             padding: 1rem;
             text-align: left;
         }
         .product-card .product-name {
             min-height: 40px;
             display: -webkit-box;
             -webkit-line-clamp: 2;
             -webkit-box-orient: vertical;
             overflow: hidden;
             text-overflow: ellipsis;
             text-align: left;
             font-weight: 500;
             color: #374151;
             margin-bottom: 0.25rem;
         }
         .product-description-snippet {
             min-height: 36px;
             display: -webkit-box;
             -webkit-line-clamp: 2;
             overflow: hidden;
             text-overflow: ellipsis;
             font-size: 0.75rem;
             color: #6b7280;
             margin-bottom: 0.5rem;
             text-align: left;
         }
         .product-card .price-section {
             display: flex;
             flex-direction: column;
             align-items: flex-start;
             margin-bottom: 0.5rem;
         }
         .site-footer {
             background-color: #f8f8f8;
             color: #555;
             font-size: 0.875rem;
         }
         .site-footer h4 {
             font-weight: 600;
             color: #333;
             margin-bottom: 1rem;
             text-transform: uppercase;
         }
         .site-footer a {
             color: #555;
             transition: color 0.2s ease;
         }
         .site-footer a:hover {
             color: #d97706;
         }
         .footer-bottom {
             background-color: #eee;
             color: #666;
             font-size: 0.75rem;
         }
         .footer-bottom .fa-cc-visa { color: #1A1F71; }
         .footer-bottom .fa-cc-amex { color: #007BC1; }
         .footer-bottom .fa-cc-paypal { color: #003087; }
         .footer-bottom .fa-cc-mastercard { color: #EB001B; }
         .footer-bottom .fa-cc-discover { color: #FF6000; }
        .fixed-chat-button {
             position: fixed;
             bottom: 30px;
             right: 30px;
             z-index: 1000;
             background-color: #eab308;
             color: white;
             width: 60px;
             height: 60px;
             border-radius: 50%;
             display: flex;
             align-items: center;
             justify-content: center;
             box-shadow: 0 4px 8px rgba(0,0,0,0.2);
             cursor: pointer;
             transition: all 0.2s ease;
         }
        @media (max-width: 767px) {
             .fixed-chat-button {
                 bottom: 84px;
                 right: auto;
                 left: 20px;
                 width: 50px;
                 height: 50px;
                 z-index: 50;
             }
             .fixed-chat-button i {
                 font-size: 24px;
             }
         }
         .fixed-chat-button:hover {
             transform: scale(1.1);
         }
       .fixed-chat-button i {
                 font-size: 24px;
             }
         
         .drawer {
             transform: translateX(100%);
             transition: transform 0.3s ease-in-out;
             z-index: 60;
         }
         .drawer-modal:not(.hidden) .drawer-bg {
             opacity: 1;
             z-index: 55;
         }
         .drawer-modal:not(.hidden) .drawer {
             transform: translateX(0);
         }
         .drawer.drawer-left {
             transform: translateX(-100%);
         }
         .drawer-modal:not(.hidden) .drawer.drawer-left {
             transform: translateX(0);
         }
         #cart-drawer {
             transform: translateX(100%);
             transition: transform 0.3s ease-in-out;
             width: 60%;
             max-width: 448px;
         }
         #cart-modal-bg {
             opacity: 0;
             transition: opacity 0.3s ease-in-out;
         }
         #cart-modal:not(.hidden) #cart-drawer {
             transform: translateX(0);
         }
         #cart-modal:not(.hidden) #cart-modal-bg {
             opacity: 1;
         }
         #search-results-area {
             background-color: #f9fafb;
             border: 1px solid #e5e7eb;
             border-radius: 0.5rem;
             margin-bottom: 2rem;
             padding: 1.5rem;
         }
         #search-results-area.hidden {
             display: none;
         }

         .loading-spinner {
             border: 4px solid #f3f3f3;
             border-top: 4px solid #eab308;
             border-radius: 50%;
             width: 40px;
             height: 40px;
             animation: spin 1s linear infinite;
         }

         @keyframes spin {
             0% { transform: rotate(0deg); }
             100% { transform: rotate(360deg); }
         }
    </style>
</head>
<body class="bg-slate-50 pb-16 md:pb-0">

    <div id="account-drawer-modal" class="drawer-modal fixed inset-0 z-50 hidden">
         <div id="account-drawer-bg" class="drawer-bg fixed inset-0 modal-bg opacity-0 transition-opacity"></div>
         <div id="account-drawer" class="drawer fixed top-0 right-0 h-full bg-white shadow-xl w-full max-w-md flex flex-col">
             
             <div id="account-drawer-logged-in" class="hidden flex flex-col h-full">
                 <div class="p-4 flex justify-between items-center border-b flex-shrink-0">
                     <h2 class="text-xl font-semibold text-slate-800">My Account</h2>
                     <button id="close-account-drawer-btn-logged-in" class="text-slate-500 hover:text-slate-800 text-sm flex items-center gap-1">
                           <i class="fas fa-times"></i> Close
                     </button>
                 </div>
                 <div class="flex-grow p-6 overflow-y-auto">
                     <p class="text-slate-600 mb-2">Welcome back,</p>
                     <h3 id="account-drawer-user-email" class="text-lg font-semibold text-slate-800 mb-6 break-words"></h3>
                     <a href="profile.html" class="w-full text-center bg-amber-600 text-white p-3 rounded-lg hover:bg-amber-700 font-bold text-base">
                         Edit Profile
                     </a>
                     <button id="drawer-logout-btn" class="w-full text-center bg-gray-100 text-gray-700 p-3 rounded-lg hover:bg-gray-200 font-bold text-base mt-4">
                         Logout
                     </button>
                 </div>
             </div>

             <div id="account-drawer-logged-out" class="hidden flex flex-col h-full">
                 <div class="p-4 border-b">
                     <div class="flex justify-between items-center">
                         <h2 class="text-xl font-bold text-slate-700">Welcome!</h2>
                         <button id="close-account-drawer-btn-logged-out" class="text-slate-500 hover:text-slate-800 text-sm flex items-center gap-1">
                             <i class="fas fa-times"></i> Close
                         </button>
                     </div>
                 </div>
                 <div class="p-2 bg-slate-100 flex gap-2">
                     <button id="drawer-login-tab-btn" class="tab-button active flex-1 bg-white p-2 rounded-md font-semibold border-b-2">Login</button>
                     <button id="drawer-signup-tab-btn" class="tab-button flex-1 bg-white p-2 rounded-md font-semibold text-slate-500 border-b-2 border-transparent">Sign Up</button>
                 </div>
                 <div class="p-6" style="max-height: 70vh; overflow-y: auto;">
                     <form id="drawer-login-form" class="space-y-4">
                         <input type="email" id="drawer-login-email" placeholder="Email" required class="w-full p-3 border rounded-md">
                         <input type="password" id="drawer-login-password" placeholder="Password" required class="w-full p-3 border rounded-md">
                         <button type="submit" class="w-full bg-amber-600 text-white p-3 rounded-md hover:bg-amber-700">Login</button>
                         <p id="drawer-login-error" class="text-red-500 text-sm text-center"></p>
                     </form>
                     <form id="drawer-signup-form" class="space-y-4 hidden">
                         <input type="text" id="drawer-signup-name" placeholder="Full Name" required class="w-full p-3 border rounded-md">
                         <input type="email" id="drawer-signup-email" placeholder="Email" required class="w-full p-3 border rounded-md">
                         <input type="password" id="drawer-signup-password" placeholder="Password" required class="w-full p-3 border rounded-md">
                         <input type="tel" id="drawer-signup-phone" placeholder="Phone Number" required class="w-full p-3 border rounded-md">
                         <input type="text" id="drawer-signup-address" placeholder="Address" required class="w-full p-3 border rounded-md">
                         <div class="grid grid-cols-2 gap-4">
                             <input type="text" id="drawer-signup-city" placeholder="City" required class="w-full p-3 border rounded-md">
                             <input type="text" id="drawer-signup-district" placeholder="District" required class="w-full p-3 border rounded-md">
                         </div>
                         <input type="text" id="drawer-signup-postal-code" placeholder="Postal Code" required class="w-full p-3 border rounded-md">
                         <button type="submit" class="w-full bg-amber-600 text-white p-3 rounded-md hover:bg-amber-700">Create Account</button>
                         <p id="drawer-signup-error" class="text-red-500 text-sm text-center"></p>
                     </form>
                 </div>
             </div>
         </div>
    </div>
    
    <div id="main-menu-drawer-modal" class="drawer-modal fixed inset-0 z-50 hidden md:hidden">
         <div id="main-menu-drawer-bg" class="drawer-bg fixed inset-0 modal-bg opacity-0 transition-opacity"></div>
         
         <div id="main-menu-drawer" class="drawer drawer-left fixed top-0 left-0 h-full bg-white shadow-xl w-full max-w-xs flex flex-col">
            <div class="flex flex-col h-full">
                <div class="p-4 flex justify-between items-center border-b flex-shrink-0 bg-slate-50">
                    <h2 class="text-lg font-semibold text-slate-800 uppercase">Menu</h2>
                    <button id="close-main-menu-drawer-btn" class="text-slate-500 hover:text-slate-800 text-sm flex items-center gap-1">
                        <i class="fas fa-times"></i> Close
                    </button>
                </div>

                <div class="p-4 border-b">
                    <div class="flex border border-gray-300 rounded-md overflow-hidden">
                        <input type="text" id="drawer-search-bar" placeholder="Search for products" class="w-full px-4 py-2 focus:outline-none text-sm">
                        <button id="drawer-search-btn" class="bg-gray-100 px-4 text-gray-600 hover:bg-gray-200">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>

                <div class="flex border-b">
                    <button id="drawer-menu-tab-btn" class="drawer-tab active flex-1 py-3 text-sm font-semibold uppercase tracking-wider">
                        Menu
                    </button>
                    <button id="drawer-categories-tab-btn" class="drawer-tab flex-1 py-3 text-sm font-semibold uppercase tracking-wider text-gray-500">
                        Categories
                    </button>
                </div>

                <div class="flex-grow overflow-y-auto">
                    <nav id="drawer-menu-content" class="text-gray-700">
                        <a href="index.html" class="drawer-menu-link">HOME</a>
                        <a href="shop.html" class="drawer-menu-link">SHOP</a>
                        <a href="about.html" class="drawer-menu-link active-link">ABOUT US</a>
                        <a href="contact.html" class="drawer-menu-link">CONTACT US</a>
                        
                        <div class="px-5 py-3 mt-2 bg-slate-50 border-y">
                            <span class="text-xs font-semibold text-gray-500 uppercase">My Account</span>
                        </div>

                        <a href="wishlist.html" class="drawer-menu-link flex items-center gap-3">
                            <i class="fas fa-heart w-4 text-center text-gray-500"></i>
                            <span>WISHLIST</span>
                        </a>
                        <a href="#" class="drawer-menu-link flex items-center gap-3">
                            <i class="fas fa-exchange-alt w-4 text-center text-gray-500"></i>
                            <span>COMPARE</span>
                        </a>
                        <button id="drawer-my-account-btn" class="drawer-menu-link w-full flex justify-between items-center text-left">
                            <span class="flex items-center gap-3">
                                <i class="fas fa-user w-4 text-center text-gray-500"></i>
                                <span>MY ACCOUNT</span>
                            </span>
                            <i class="fas fa-chevron-right text-xs text-gray-400"></i>
                        </button>
                    </nav>

                    <div id="main-menu-category-list" class="category-drawer hidden">
                        <p class="p-4 text-slate-500">Loading categories...</p>
                    </div>
                </div>
            </div>
         </div>
    </div>

    <div id="cart-modal" class="fixed inset-0 z-50 hidden">
           <div id="cart-modal-bg" class="fixed inset-0 modal-bg"></div>
           <div id="cart-drawer" class="fixed top-0 right-0 h-full bg-white shadow-xl flex flex-col">
                 <div class="p-4 flex justify-between items-center border-b flex-shrink-0">
                     <h2 class="text-xl font-semibold text-slate-800">Shopping cart</h2>
                     <button id="close-cart-btn" class="text-slate-500 hover:text-slate-800 text-sm flex items-center gap-1">
                          <i class="fas fa-times"></i> Close
                     </button>
                 </div>
                 <div class="flex-grow p-6 overflow-y-auto">
                     <div id="cart-items-container" class="divide-y divide-slate-100">
                          <p class="text-slate-500 py-6 text-center">Your cart is empty.</p>
                     </div>
                 </div>
                 <div class="p-6 border-t bg-slate-50 flex-shrink-0">
                     <div class="flex justify-between items-center mb-2">
                          <span class="text-lg font-medium text-slate-600">Subtotal:</span>
                          <span id="cart-total" class="text-xl font-bold text-amber-600">Rs. 0.00</span>
                     </div>
                     <p class="text-sm text-center text-slate-500 mb-2">Shipping & taxes calculated at checkout.</p>
                     <div class="flex flex-col gap-3 mt-4">
                          <a href="cart.html" class="w-full text-center bg-white border-2 border-amber-600 text-amber-600 p-3 rounded-lg hover:bg-amber-50 font-bold text-base">
                                VIEW CART
                          </a>
                          <a href="checkout.html" id="checkout-btn-modal" class="w-full text-center bg-amber-600 text-white p-3 rounded-lg hover:bg-amber-700 font-bold text-base">
                                CHECKOUT
                          </a>
                     </div>
                 </div>
           </div>
     </div>

    <div id="tracking-modal" class="fixed inset-0 modal-bg z-50 flex items-center justify-center hidden"> <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl m-4" style="max-height: 90vh;"> <div class="p-6 flex justify-between items-center border-b"> <h2 class="text-3xl font-bold text-slate-800">My Orders</h2> <button id="close-tracking-btn" class="text-slate-500 hover:text-slate-800 text-3xl leading-none">&times;</button> </div> <div id="tracking-items-container" class="p-6 flex flex-col" style="max-height: calc(90vh - 100px); overflow-y: auto;"> <p class="text-slate-500 text-center">Loading your orders...</p> </div> </div> </div>

    <header class="sticky top-0 z-40 bg-white shadow-md">
        <div class="header-top-bar text-white py-1.5 text-xs md:text-[0.7rem] md:font-medium md:uppercase md:tracking-wider">
            <div class="container mx-auto px-4 flex justify-center md:justify-between items-center">
                <span class="hidden md:inline">Your Ultimate Destination</span>
                <div class="hidden md:flex items-center space-x-4">
                    <a href="#" title="Facebook"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" title="Instagram"><i class="fab fa-instagram"></i></a>
                    <a href="#" title="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                    <span class="border-l border-amber-400 h-4 opacity-50"></span>
                    <a href="#">Newsletter</a>
                    <a href="#">Contact Us</a>
                    <a href="#">FAQs</a>
                </div>
                <div class="flex items-center space-x-4 md:hidden">
                    <a href="#" title="Facebook"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" title="Instagram"><i class="fab fa-instagram"></i></a>
                    <a href="#" title="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                </div>
            </div>
        </div>

        <div class="py-4 border-b">
            <div class="container mx-auto px-4 flex justify-between items-center gap-4">

                <button id="hamburger-menu-btn" class="text-gray-600 hover:text-amber-700 md:hidden text-xl p-1">
                    <i class="fas fa-bars"></i>
                </button>

                <a href="index.html" id="logo-btn" class="flex-shrink-0 hidden md:inline-block">
                    <img src="LOGO.png" alt="TPA - The Phone Arcade" class="h-10 md:h-12">
                </a>

                <div class="flex-grow flex justify-center md:hidden">
                    <a href="index.html" id="mobile-logo-btn">
                        <img src="LOGO.png" alt="TPA" class="h-10">
                    </a>
                </div>

                <div class="flex-grow hidden md:flex border border-gray-300 rounded-md overflow-hidden max-w-xl">
                    <input type="text" id="search-bar" placeholder="Search for products" class="w-full px-4 py-2 focus:outline-none text-sm">
                    <select id="search-category-dropdown" class="border-l border-gray-300 px-2 text-sm text-gray-600 focus:outline-none bg-gray-50 hidden md:block">
                        <option value="all">ALL CATEGORIES</option>
                    </select>
                    <button id="search-icon-btn" class="bg-gray-100 px-4 text-gray-600 hover:bg-gray-200"> <i class="fas fa-search"></i> </button>
                </div>

                <div class="flex items-center space-x-3 md:space-x-4 text-gray-700 text-sm">

                    <div id="auth-links" class="hidden md:flex items-center space-x-1">
                        
                        <button id="login-btn-nav" class="hover:text-amber-700">LOGIN</button>
                        <span>/</span>
                        <button id="signup-btn-nav" class="hover:text-amber-700">REGISTER</button>
                    </div>

                    <div id="user-info" class="hidden md:flex items-center space-x-2">
                        <i class="fas fa-user text-gray-500"></i>
                        <span id="user-email" class="font-medium text-gray-700 truncate max-w-[150px]" title=""></span>
                        <span class="text-gray-400">|</span>
                        <button id="logout-btn-nav" class="hover:text-red-600 text-gray-600 font-medium uppercase text-xs tracking-wider">Logout</button>
                    </div>

                    <a href="wishlist.html" title="Wishlist" class="relative hover:text-amber-700 hidden md:flex items-center">
                        <i class="fas fa-heart text-xl"></i>
                        <span id="wishlist-count-badge" class="absolute -top-1 -right-1 bg-amber-600 text-white text-[10px] rounded-full h-4 w-4 flex items-center justify-center font-bold">0</span>
                    </a>

                    <a href="#" title="Compare" class="relative hover:text-amber-700 hidden md:flex items-center">
                        <i class="fas fa-exchange-alt text-xl"></i>
                        <span class="absolute -top-1 -right-1 bg-amber-600 text-white text-[10px] rounded-full h-4 w-4 flex items-center justify-center font-bold">0</span>
                    </a>

                    <a href="cart.html" id="cart-icon" title="Cart" class="relative hover:text-amber-700 hidden md:flex items-center">
                        <i class="fas fa-shopping-bag text-xl"></i>
                        <span id="cart-count-badge" class="absolute -top-1 -right-1 bg-amber-600 text-white text-[10px] rounded-full h-4 w-4 flex items-center justify-center font-bold">0</span>
                        <span class="ml-2 font-semibold hidden lg:inline">Rs.0.00</span>
                    </a>

                    <button id="mobile-header-cart-btn" title="Cart" class="relative hover:text-amber-700 md:hidden text-gray-600 text-xl p-1">
                    <i class="fas fa-shopping-bag"></i>
                    <span id="mobile-header-cart-badge" class="absolute -top-1 -right-1.5 bg-amber-600 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center">0</span>
                    </button>

                </div>
            </div>
        </div>

        <nav class="main-nav hidden md:block bg-white border-b">
            <div class="container mx-auto px-4 flex justify-between items-center h-12">
                <div class="flex space-x-6 text-sm font-medium">
                    <a href="index.html" class="text-gray-700 hover:text-amber-700">HOME</a>
                    <a href="shop.html" class="text-gray-700 hover:text-amber-700">SHOP</a>
                    <a href="about.html" class="text-amber-600 hover:text-gray-900 font-semibold">ABOUT US</a>
                    <a href="contact.html" class="text-gray-700 hover:text-amber-700">CONTACT US</a>
                </div>
                <a href="#" class="text-amber-600 font-semibold text-sm flex items-center gap-1 hover:text-gray-900">
                    <i class="fas fa-heart text-xs"></i> SPECIAL OFFERS
                </a>
            </div>
        </nav>
    </header>

    <div id="search-results-area" class="container mx-auto p-4 hidden">
        <h2 id="search-results-title" class="text-2xl font-bold text-gray-800 mb-4">Search Results</h2>
        <img id="search-category-banner" src="" alt="Category Banner" class="w-full h-auto object-cover rounded-lg shadow-md mb-6 hidden" style="max-height: 300px;">
        <div id="search-results-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
             <p class="col-span-full text-center text-gray-500 py-5">Searching...</p>
        </div>
    </div>

    <main id="about-us-main-content" class="container mx-auto p-4 md:p-8">

        <div class="bg-white rounded-lg shadow-xl overflow-hidden max-w-4xl mx-auto p-6 md:p-10">
            
            <h1 class="text-3xl font-bold text-gray-800 mb-4">About TPA</h1>
            <p class="text-lg text-gray-600 mb-6">Welcome to <span class="font-bold text-gray-700">TPA - The Phone Arcade</span>, your ultimate destination for high-quality electronics, essentials & appliances, now at your fingertips.</p>

            <div classs="prose prose-lg max-w-none">
                <h2 class="text-2xl font-semibold text-gray-700 mt-8 mb-3">Our Story</h2>
                <p class="text-gray-600 leading-relaxed mb-4">
                    Founded in Polonnaruwa, TPA started as a small shop with a big dream: to bring the latest in mobile technology and electronics to our community. Over the years, we've grown from a local favorite into a trusted islandwide provider, thanks to our commitment to quality and our passion for customer service.
                </p>
                <p class="text-gray-600 leading-relaxed">
                    Today, we offer a vast selection of products, from the newest smartphones and accessories to essential home appliances. Our journey is driven by our customers, and we're proud to be a part of your lives.
                </p>

                <h2 class="text-2xl font-semibold text-gray-700 mt-8 mb-3">Our Mission</h2>
                <p class="text-gray-600 leading-relaxed mb-4">
                    Our mission is simple: to provide our customers with the best products at competitive prices, backed by fast delivery and exceptional customer support. We strive to make technology accessible and affordable for everyone in Sri Lanka.
                </p>

                <h2 class="text-2xl font-semibold text-gray-700 mt-8 mb-4">Why Choose Us?</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="text-center p-4 rounded-lg">
                        <i class="fas fa-gem text-4xl text-amber-600 mb-3"></i>
                        <h3 class="font-bold text-lg text-gray-800">Quality Products</h3>
                        <p class="text-sm text-gray-600">We source only genuine, high-quality products from trusted brands.</p>
                    </div>
                    <div class="text-center p-4 rounded-lg">
                        <i class="fas fa-shipping-fast text-4xl text-amber-600 mb-3"></i>
                        <h3 class="font-bold text-lg text-gray-800">Fast Delivery</h3>
                        <p class="text-sm text-gray-600">Get your orders delivered to your doorstep, islandwide, with speed and care.</p>
                    </div>
                    <div class="text-center p-4 rounded-lg">
                        <i class="fas fa-headset text-4xl text-amber-600 mb-3"></i>
                        <h3 class="font-bold text-lg text-gray-800">Great Support</h3>
                        <p class="text-sm text-gray-600">Our dedicated team is always here to help you with any questions.</p>
                    </div>
                </div>

                <h2 class="text-2xl font-semibold text-gray-700 mt-8 mb-4">Visit Our Store</h2>
                <p class="text-gray-600 leading-relaxed mb-4">
                    We'd love to see you in person! Find us at our flagship store:
                </p>
                <div class="space-y-3 text-gray-700">
                    <p><i class="fas fa-map-marker-alt mr-3 text-amber-700 w-4 text-center"></i> 890/a Main Street, Kaduruwela, Polonnaruwa</p>
                    <p><i class="fas fa-phone-alt mr-3 text-amber-700 w-4 text-center"></i> Phone: 077 754 9654 / 027 222 4470</p>
                    <p><i class="fas fa-envelope mr-3 text-amber-700 w-4 text-center"></i> Email: info@thephonearcade.com</p>
                </div>

            </div>
        </div>
    </main>

    <footer class="site-footer border-t pt-10 mt-10 hidden md:block">
            <div class="container mx-auto px-4 pb-10">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                    <div class="space-y-4">
                        <img src="LOGO.png" alt="TPA - The Phone Arcade" class="h-10 mb-4">
                        <p>High-quality electronics, essentials & appliances are now at your fingertips. Confirm your order now !</p>
                        <p><i class="fas fa-map-marker-alt mr-2 text-amber-700"></i> 890/a Main Street, Kaduruwela, Polonnaruwa</p>
                        <p><i class="fas fa-phone-alt mr-2 text-amber-700"></i> Phone: 077 754 9654 / 027 222 4470</p>
                        <p><i class="fas fa-envelope mr-2 text-amber-700"></i> Email: info@thephonearcade.com</p>
                    </div>
                    <div>
                        <h4>Quick Links</h4>
                        <ul class="space-y-2">
                            <li><a href="index.html">Home</a></li>
                            <li><a href="shop.html">Shop</a></li>
                            <li><a href="about.html">About Us</a></li>
                            <li><a href="contact.html">Contact Us</a></li>
                            <li><a href="#">Special Offers</a></li>
                        </ul>
                    </div>
                    <div>
                        <h4>Useful Links</h4>
                        <ul class="space-y-2">
                            <li><a href="#">Privacy Policy</a></li>
                            <li><a href="#">Returns</a></li>
                            <li><a href="#">Terms & Conditions</a></li>
                            <li><a href="#">Contact Us</a></li>
                            <li><a href="#">Latest News</a></li>
                            <li><a href="#">Our Sitemap</a></li>
                        </ul>
                    </div>
                    <div>
                        <h4>My Account</h4>
                        <ul class="space-y-2">
                            <li><a href="profile.html">My Profile</a></li>
                            <li><a href="cart.html">View Cart</a></li>
                            <li><a href="#" id="footer-orders-link">Track My Orders</a></li>
                            <li><a href="wishlist.html">My Wishlist</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="footer-bottom py-4 px-4">
                <div class="container mx-auto flex flex-col md:flex-row justify-between items-center text-center md:text-left">
                    <span>TPA © 2025 CREATED BY <a href="https://pixora.com" target="_blank" rel="noopener noreferrer" class="font-semibold hover:text-amber-700">PIXORA IT SOLUTIONS</a></span>
                    <div class="flex space-x-2 mt-4 md:mt-0">
                        <i class="fab fa-cc-visa text-2xl"></i>
                        <i class="fab fa-cc-amex text-2xl"></i>
                        <i class="fab fa-cc-paypal text-2xl"></i>
                        <i class="fab fa-cc-mastercard text-2xl"></i>
                        <i class="fab fa-cc-discover text-2xl"></i>
                        </div>
                </div>
            </div>
    </footer>

    <nav class="fixed bottom-0 left-0 right-0 h-16 bg-white border-t border-gray-200 shadow-[0_-2px_6px_rgba(0,0,0,0.06)] md:hidden z-40 flex justify-around items-center">
    
      <a href="index.html" class="flex flex-col items-center justify-center text-gray-600 hover:text-amber-600 text-xs w-1/4">
           <i class="fas fa-store text-xl"></i>
           <span class="mt-1">Shop</span>
      </a>
    
      <a href="wishlist.html" class="flex flex-col items-center justify-center text-gray-600 hover:text-amber-600 text-xs w-1/4 relative">
           <div class="relative">
                <i class="fas fa-heart text-xl"></i>
                <span id="mobile-wishlist-badge" class="absolute -top-1 -right-2.5 bg-amber-600 text-white text-xs font-semibold rounded-full h-4 w-4 flex items-center justify-center">0</span>
           </div>
           <span class="mt-1">Wishlist</span>
      </a>
    
      <a href="cart.html" id="mobile-cart-link" class="flex flex-col items-center justify-center text-gray-600 hover:text-amber-600 text-xs w-1/4 relative">
            <div class="relative">
                <i class="fas fa-shopping-bag text-xl"></i>
                <span id="mobile-cart-badge" class="absolute -top-1 -right-2.5 bg-amber-600 text-white text-xs font-semibold rounded-full h-4 w-4 flex items-center justify-center">0</span>
           </div>
           <span class="mt-1">Cart</span>
      </a>
    
      <a href="profile.html" id="mobile-account-link" class="flex flex-col items-center justify-center text-gray-600 hover:text-amber-600 text-xs w-1/4">
           <i class="fas fa-user text-xl"></i>
           <span class="mt-1">My account</span>
      </a>
    </nav>

    <a href="https://wa.me/94777349654?text=Hello%20TPA%2C%20I'd%20like%20to%20ask%20a%20question."
         class="fixed-chat-button"
         aria-label="Chat on WhatsApp"
         target="_blank"
         rel="noopener noreferrer">
        <i class="fab fa-whatsapp"></i> 
    </a>

    <script type="module">

    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, where, serverTimestamp, setDoc, doc, limit, getDoc, getDocs } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

    // --- Firebase Config ---
    const firebaseConfig = {
     apiKey: "AIzaSyAtvnbedBpCiRe_ZyfoB-TacrboEMgft5Y", authDomain: "mobile-shop-1c315.firebaseapp.com", projectId: "mobile-shop-1c315", storageBucket: "mobile-shop-1c315.firebasestorage.app", messagingSenderId: "689278786227", appId: "1:689278786227:web:ee06565e4a230381bf6ec6", measurementId: "G-MLDEWBBEMV"
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // --- Firestore Collections ---
    const productsCol = collection(db, 'products');
    const categoriesCol = collection(db, 'categories');
    const usersCol = collection(db, 'users');
    const offersCol = collection(db, 'offers');
    const ordersCol = collection(db, 'orders');

    // --- DOM Elements ---
    const categorySidebarList = document.getElementById('category-sidebar-list');
    const searchBar = document.getElementById('search-bar');
    const searchCategoryDropdown = document.getElementById('search-category-dropdown');
    const searchIconBtn = document.getElementById('search-icon-btn');
    const logoBtn = document.getElementById('logo-btn');
    const mobileLogoBtn = document.getElementById('mobile-logo-btn');
    
    // Account Drawer
    const accountDrawerModal = document.getElementById('account-drawer-modal');
    const accountDrawerBg = document.getElementById('account-drawer-bg');
    const closeAccountDrawerBtnLoggedIn = document.getElementById('close-account-drawer-btn-logged-in');
    const closeAccountDrawerBtnLoggedOut = document.getElementById('close-account-drawer-btn-logged-out');
    const accountDrawerLoggedIn = document.getElementById('account-drawer-logged-in');
    const accountDrawerLoggedOut = document.getElementById('account-drawer-logged-out');
    const accountDrawerUserEmail = document.getElementById('account-drawer-user-email');
    const drawerLogoutBtn = document.getElementById('drawer-logout-btn');
    const loginBtnNav = document.getElementById('login-btn-nav');
    const signupBtnNav = document.getElementById('signup-btn-nav');
    const loginTab = document.getElementById('drawer-login-tab-btn');
    const signupTab = document.getElementById('drawer-signup-tab-btn');
    const loginForm = document.getElementById('drawer-login-form');
    const signupForm = document.getElementById('drawer-signup-form');
    const authLinks = document.getElementById('auth-links');
    
    // Cart
    const cartCountBadge = document.getElementById('cart-count-badge');
    const cartIcon = document.getElementById('cart-icon');
    const mobileHeaderCartBtn = document.getElementById('mobile-header-cart-btn');
    const mobileHeaderCartBadge = document.getElementById('mobile-header-cart-badge');
    const cartModal = document.getElementById('cart-modal');
    const cartModalBg = document.getElementById('cart-modal-bg');
    const closeCartBtn = document.getElementById('close-cart-btn');
    const cartItemsContainer = document.getElementById('cart-items-container');
    const cartTotalEl = document.getElementById('cart-total');

    // Main Menu (Mobile)
    const hamburgerMenuBtn = document.getElementById('hamburger-menu-btn');
    const mainMenuDrawerModal = document.getElementById('main-menu-drawer-modal');
    const mainMenuDrawerBg = document.getElementById('main-menu-drawer-bg');
    const closeMainMenuDrawerBtn = document.getElementById('close-main-menu-drawer-btn');
    const mainMenuCategoryList = document.getElementById('main-menu-category-list');
    const drawerSearchBtn = document.getElementById('drawer-search-btn');
    const drawerSearchBar = document.getElementById('drawer-search-bar');
    const drawerMenuTabBtn = document.getElementById('drawer-menu-tab-btn');
    const drawerCategoriesTabBtn = document.getElementById('drawer-categories-tab-btn');
    const drawerMenuContent = document.getElementById('drawer-menu-content');
    const drawerMyAccountBtn = document.getElementById('drawer-my-account-btn');

    // Bottom Nav (Mobile)
    const mobileCartLink = document.getElementById('mobile-cart-link');
    const mobileAccountLink = document.getElementById('mobile-account-link');

    // Tracking Modal
    const trackingModal = document.getElementById('tracking-modal');
    const closeTrackingBtn = document.getElementById('close-tracking-btn');
    const trackingIconBtn = document.getElementById('tracking-icon-btn');
    const trackingItemsContainer = document.getElementById('tracking-items-container');
    const footerOrdersLink = document.getElementById('footer-orders-link');

    // Search Results
    const searchResultsArea = document.getElementById('search-results-area');
    const searchResultsTitle = document.getElementById('search-results-title');
    const searchCategoryBanner = document.getElementById('search-category-banner');
    const searchResultsGrid = document.getElementById('search-results-grid');

    // Page Content
    const mainContentSections = [
        document.getElementById('about-us-main-content')
    ];

    // --- Global State ---
    let currentProducts = [];
    let allActiveOffers = new Map();
    let categoriesCache = [];

    // --- Account Drawer Functions ---
    const openAccountDrawer = () => {
         if(accountDrawerModal) accountDrawerModal.classList.remove('hidden');
    }
    const closeAccountDrawer = () => {
         if(accountDrawerModal) accountDrawerModal.classList.add('hidden');
    }

    // --- Main Menu Drawer Functions ---
    const openMainMenuDrawer = () => {
         if(mainMenuDrawerModal) mainMenuDrawerModal.classList.remove('hidden');
    }
    const closeMainMenuDrawer = () => {
         if(mainMenuDrawerModal) mainMenuDrawerModal.classList.add('hidden');
    }

    // --- Auth State & Logic ---
    onAuthStateChanged(auth, async (user) => {
         if (user) {
             if(authLinks) { authLinks.classList.add('hidden'); authLinks.classList.remove('md:block'); }
             
             if(accountDrawerLoggedIn) accountDrawerLoggedIn.classList.remove('hidden');
             if(accountDrawerLoggedIn) accountDrawerLoggedIn.classList.add('flex');
             if(accountDrawerLoggedOut) accountDrawerLoggedOut.classList.add('hidden');
             if(accountDrawerLoggedOut) accountDrawerLoggedOut.classList.remove('flex');

             try {
                 const userDocRef = doc(db, "users", user.uid);
                 const userDoc = await getDoc(userDocRef);
                 const userData = userDoc.exists() ? userDoc.data() : {};
                 const userDisplayName = userData.role === "admin" ? `${user.email} (Admin)` : user.email;

                 if(accountDrawerUserEmail) accountDrawerUserEmail.textContent = userDisplayName;

             } catch (error) {
                 console.error("Error fetching user role: ", error);
                 if(accountDrawerUserEmail) accountDrawerUserEmail.textContent = user.email;
             }
             
             closeAccountDrawer();

             if(mobileAccountLink) {
                 mobileAccountLink.href = 'profile.html';
                 mobileAccountLink.onclick = null;
             }
         } else {
             if(authLinks) { authLinks.classList.remove('hidden', 'md:block'); authLinks.classList.add('md:block'); }

             if(accountDrawerLoggedIn) accountDrawerLoggedIn.classList.add('hidden');
             if(accountDrawerLoggedIn) accountDrawerLoggedIn.classList.remove('flex');
             if(accountDrawerLoggedOut) accountDrawerLoggedOut.classList.remove('hidden');
             if(accountDrawerLoggedOut) accountDrawerLoggedOut.classList.add('flex');

             if(mobileAccountLink) {
                 mobileAccountLink.href = '#';
                 mobileAccountLink.onclick = (e) => {
                     e.preventDefault();
                     openAccountDrawer();
                 };
             }
         }
    });

    if(loginBtnNav) loginBtnNav.addEventListener('click', () => openAccountDrawer(true));
    if(signupBtnNav) signupBtnNav.addEventListener('click', () => { openAccountDrawer(); if(signupTab) signupTab.click(); });
    
    if(closeAccountDrawerBtnLoggedIn) closeAccountDrawerBtnLoggedIn.addEventListener('click', closeAccountDrawer);
    if(closeAccountDrawerBtnLoggedOut) closeAccountDrawerBtnLoggedOut.addEventListener('click', closeAccountDrawer);
    if(accountDrawerBg) accountDrawerBg.addEventListener('click', closeAccountDrawer);
    
    if(loginTab) loginTab.addEventListener('click', () => { loginTab.classList.add('active'); if(signupTab) signupTab.classList.remove('active'); if(loginForm) loginForm.classList.remove('hidden'); if(signupForm) signupForm.classList.add('hidden'); });
    if(signupTab) signupTab.addEventListener('click', () => { signupTab.classList.add('active'); if(loginTab) loginTab.classList.remove('active'); if(signupForm) signupForm.classList.remove('hidden'); if(loginForm) loginForm.classList.add('hidden'); });
    
    if(loginForm) loginForm.addEventListener('submit', async (e) => {
         e.preventDefault();
         const email = document.getElementById('drawer-login-email').value;
         const password = document.getElementById('drawer-login-password').value;
         const errorP = document.getElementById('drawer-login-error');
         if(errorP) errorP.textContent = 'Logging in...';
         try {
             await signInWithEmailAndPassword(auth, email, password);
         } catch (error) {
             console.error("Login Error:", error);
             if(errorP) errorP.textContent = error.message;
         }
    });
    
    if(signupForm) signupForm.addEventListener('submit', async (e) => {
         e.preventDefault();
         const email = document.getElementById('drawer-signup-email').value;
         const password = document.getElementById('drawer-signup-password').value;
         const name = document.getElementById('drawer-signup-name').value;
         const phone = document.getElementById('drawer-signup-phone').value;
         const address = document.getElementById('drawer-signup-address').value;
         const city = document.getElementById('drawer-signup-city').value;
         const district = document.getElementById('drawer-signup-district').value;
         const postalCode = document.getElementById('drawer-signup-postal-code').value;
         const errorP = document.getElementById('drawer-signup-error');
         if(errorP) errorP.textContent = 'Creating account...';
         try {
             const userCredential = await createUserWithEmailAndPassword(auth, email, password);
             const user = userCredential.user;
             await setDoc(doc(db, "users", user.uid), { name: name, email: email, phone: phone, address: address, city: city, district: district, postalCode: postalCode, createdAt: serverTimestamp(), role: "customer" });
         } catch (error) {
             console.error("Signup Error:", error);
             if(errorP) errorP.textContent = error.message;
         }
    });

    if(drawerLogoutBtn) drawerLogoutBtn.addEventListener('click', () => { signOut(auth); });

    // --- Main Menu Drawer Logic ---
    if(hamburgerMenuBtn) hamburgerMenuBtn.addEventListener('click', openMainMenuDrawer);
    if(closeMainMenuDrawerBtn) closeMainMenuDrawerBtn.addEventListener('click', closeMainMenuDrawer);
    if(mainMenuDrawerBg) mainMenuDrawerBg.addEventListener('click', closeMainMenuDrawer);

    if(drawerMyAccountBtn) drawerMyAccountBtn.addEventListener('click', () => {
        closeMainMenuDrawer();
        openAccountDrawer();
    });

    if(drawerMenuTabBtn) drawerMenuTabBtn.addEventListener('click', () => {
        drawerMenuTabBtn.classList.add('active');
        drawerMenuTabBtn.classList.remove('text-gray-500');
        drawerCategoriesTabBtn.classList.remove('active');
        drawerCategoriesTabBtn.classList.add('text-gray-500');
        
        if (drawerMenuContent) drawerMenuContent.classList.remove('hidden');
        if (mainMenuCategoryList) mainMenuCategoryList.classList.add('hidden');
    });

    if(drawerCategoriesTabBtn) drawerCategoriesTabBtn.addEventListener('click', () => {
        drawerCategoriesTabBtn.classList.add('active');
        drawerCategoriesTabBtn.classList.remove('text-gray-500');
        drawerMenuTabBtn.classList.remove('active');
        drawerMenuTabBtn.classList.add('text-gray-500');

        if (drawerMenuContent) drawerMenuContent.classList.add('hidden');
        if (mainMenuCategoryList) mainMenuCategoryList.classList.remove('hidden');
    });

    // --- Cart Logic ---
    const getCart = () => JSON.parse(localStorage.getItem('mobileHubCart')) || [];
    const saveCart = (cart) => localStorage.setItem('mobileHubCart', JSON.stringify(cart));
    
    const updateCartCountBadge = () => {
         const cart = getCart();
         const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
         const cartTotalValue = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
         
         if (cartCountBadge) {
             if (totalItems > 0) {
                 cartCountBadge.textContent = totalItems;
                 cartCountBadge.classList.remove('hidden');
                 cartCountBadge.classList.add('pop');
                 setTimeout(() => cartCountBadge.classList.remove('pop'), 200);
             } else {
                 cartCountBadge.textContent = '0';
                 cartCountBadge.classList.remove('hidden', 'pop');
             }
         }
         
         const cartTotalText = document.querySelector('#cart-icon span.md\\:inline');
         if (cartTotalText) {
             cartTotalText.textContent = `Rs.${cartTotalValue.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
         }

         const mobileCartBadge = document.getElementById('mobile-cart-badge');
         if (mobileCartBadge) {
              if (totalItems > 0) {
                   mobileCartBadge.textContent = totalItems;
                   mobileCartBadge.classList.remove('hidden');
              } else {
                   mobileCartBadge.textContent = '0';
              }
         }

         if (mobileHeaderCartBadge) {
             if (totalItems > 0) {
                 mobileHeaderCartBadge.textContent = totalItems;
                 mobileHeaderCartBadge.classList.remove('hidden');
             } else {
                 mobileHeaderCartBadge.textContent = '0';
             }
         }
    };

    const renderCartModal = () => {
           const cart = getCart();
           let total = 0;
           if (!cartItemsContainer || !cartTotalEl) return;
           if (cart.length === 0) {
                cartItemsContainer.innerHTML = '<p class="text-slate-500 py-6 text-center">Your cart is empty.</p>';
                cartTotalEl.textContent = 'Rs. 0.00';
                return;
           }
           cartItemsContainer.innerHTML = cart.map(item => {
                total += item.price * item.quantity;
                return `
                <div class="flex items-center gap-4 py-4">
                     <img src="${item.imageUrl || 'https://via.placeholder.com/64'}" alt="${item.name}" class="w-16 h-16 rounded object-contain mix-blend-multiply bg-slate-100 p-1">
                     <div class="flex-grow">
                          <h4 class="font-semibold text-sm text-slate-800">${item.name}</h4>
                          <div class="flex items-center gap-2 my-1">
                               <button data-id="${item.id}" class="cart-qty-decrease w-6 h-6 font-bold rounded bg-slate-100 hover:bg-slate-200 flex items-center justify-center">-</button>
                               <span class="w-6 text-center font-bold text-sm text-slate-700">${item.quantity}</span>
                               <button data-id="${item.id}" class="cart-qty-increase w-6 h-6 font-bold rounded bg-slate-100 hover:bg-slate-200 flex items-center justify-center">+</button>
                          </div>
                          <p class="text-sm text-amber-600 font-bold">Rs. ${item.price.toLocaleString('en-US', { minimumFractionDigits: 2 })}</p>
                     </div>
                     <button data-id="${item.id}" class="cart-remove-item text-slate-400 hover:text-red-500" title="Remove Item">
                          <i class="fas fa-times text-lg"></i>
                     </button>
                </div>`;
           }).join('');
           cartTotalEl.textContent = `Rs. ${total.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
    };

    const openCartModal = (e) => {
           e.preventDefault();
           renderCartModal();
           if(cartModal) cartModal.classList.remove('hidden');
    };
    if(cartIcon) cartIcon.addEventListener('click', openCartModal);
    if(mobileCartLink) mobileCartLink.addEventListener('click', openCartModal);
    if(mobileHeaderCartBtn) mobileHeaderCartBtn.addEventListener('click', openCartModal);

    if(closeCartBtn) closeCartBtn.addEventListener('click', () => { if(cartModal) cartModal.classList.add('hidden'); });
    if(cartModalBg) cartModalBg.addEventListener('click', () => { if(cartModal) cartModal.classList.add('hidden'); });

    if(cartModal) cartModal.addEventListener('click', (e) => {
           if (e.target === e.currentTarget || e.target === cartModalBg) { return; }
           const targetButton = e.target.closest('button, a');
           if (!targetButton) return;
           if (targetButton.href?.includes('cart.html') || targetButton.href?.includes('checkout.html')) { return; }
           const id = targetButton.dataset.id;
           if (!id) return;
           const cart = getCart();
           const item = cart.find(i => i.id === id);
           if (!item) return;
           if (targetButton.classList.contains('cart-qty-increase')) {
                item.quantity++;
                saveCart(cart);
           } else if (targetButton.classList.contains('cart-qty-decrease')) {
                if (item.quantity > 1) {
                     item.quantity--;
                     saveCart(cart);
                } else {
                     if (confirm('Remove item?')) { saveCart(cart.filter(i => i.id !== id)); }
                }
           } else if (targetButton.classList.contains('cart-remove-item')) {
                if (confirm('Remove item?')) { saveCart(cart.filter(i => i.id !== id)); }
           }
           renderCartModal();
           updateCartCountBadge();
    });

    // --- Wishlist Logic ---
    const getWishlist = () => JSON.parse(localStorage.getItem('mobileHubWishlist')) || [];
    const saveWishlist = (wishlist) => localStorage.setItem('mobileHubWishlist', JSON.stringify(wishlist));
    
    const updateWishlistCountBadge = () => {
           const wishlist = getWishlist();
           const totalItems = wishlist.length;
           
           const wishlistBadge = document.querySelector('a[title="Wishlist"] span');
           if (wishlistBadge) {
                if (totalItems > 0) {
                     wishlistBadge.textContent = totalItems;
                     wishlistBadge.classList.remove('hidden');
                } else {
                     wishlistBadge.textContent = '0';
                }
                 wishlistBadge.classList.add('pop');
                 setTimeout(() => wishlistBadge.classList.remove('pop'), 200);
           }

         const mobileWishlistBadge = document.getElementById('mobile-wishlist-badge');
         if (mobileWishlistBadge) {
              if (totalItems > 0) {
                   mobileWishlistBadge.textContent = totalItems;
                   mobileWishlistBadge.classList.remove('hidden');
              } else {
                   mobileWishlistBadge.textContent = '0';
              }
         }
    };

    const addToWishlist = (productId) => {
           const wishlist = getWishlist();
           const product = currentProducts.find(p => p.id === productId);
           if (!product) {
               alert("Error: Product data not found. Please try again.");
               return;
           }
           const existingItem = wishlist.find(item => item.id === productId);
           if (existingItem) {
                alert(`${product.name} is already in your wishlist.`);
           } else {
                wishlist.push({ id: product.id, name: product.name, price: product.price, imageUrl: product.imageUrl });
                saveWishlist(wishlist);
                updateWishlistCountBadge();
                alert(`${product.name} added to wishlist!`);
           }
    };

    // --- Tracking Modal Logic ---
    if(trackingIconBtn) trackingIconBtn.addEventListener('click', (e) => { e.preventDefault(); if(trackingModal) trackingModal.classList.remove('hidden'); loadUserOrders(); });
    if(footerOrdersLink) footerOrdersLink.addEventListener('click', (e) => { e.preventDefault(); if(trackingModal) trackingModal.classList.remove('hidden'); loadUserOrders(); });
    if(closeTrackingBtn) closeTrackingBtn.addEventListener('click', () => { if(trackingModal) trackingModal.classList.add('hidden'); });
    
    const loadUserOrders = async () => {
         if(!trackingItemsContainer) return;
         trackingItemsContainer.innerHTML = '<p class="text-slate-500 text-center">Loading your orders...</p>';
         const user = auth.currentUser;
         if (!user) {
             trackingItemsContainer.innerHTML = ` <div class="text-center p-8"> <h3 class="text-xl font-semibold text-slate-700 mb-4">Please Log In</h3> <p class="text-slate-500 mb-6">You need to be logged in to view your order history.</p> <button id="tracking-login-btn" class="bg-amber-600 text-white px-6 py-2 rounded-md font-semibold hover:bg-amber-700">Login Now</button> </div>`;
             const trackingLoginBtn = document.getElementById('tracking-login-btn');
             if (trackingLoginBtn) {
                 trackingLoginBtn.addEventListener('click', () => {
                     if(trackingModal) trackingModal.classList.add('hidden');
                     openAccountDrawer();
                 });
             }
             return;
         }
         try {
             const q = query(ordersCol, where("userId", "==", user.uid), orderBy("createdAt", "desc"));
             const querySnapshot = await getDocs(q);
             if (querySnapshot.empty) {
                 trackingItemsContainer.innerHTML = ` <div class="text-center p-8"> <h3 class="text-xl font-semibold text-slate-700 mb-4">No Orders Found</h3> <p class="text-slate-500">You haven't placed any orders with us yet.</p> </div>`;
                 return;
             }
             trackingItemsContainer.innerHTML = querySnapshot.docs.map(doc => { const order = doc.data() || {}; const orderId = doc.id; const createdDate = order.createdAt ? order.createdAt.toDate().toLocaleDateString('si-LK', { day: 'numeric', month: 'long', year: 'numeric' }) : 'N/A'; const itemSummary = (order.items || []).map(item => `${item.name || 'Item'} (x${item.quantity || 1})`).join(', '); let statusColor = 'bg-slate-100 text-slate-700'; const statusLower = (order.status || 'Pending').toLowerCase(); if (statusLower === 'pending') statusColor = 'bg-yellow-100 text-yellow-800'; else if (statusLower === 'shipped' || statusLower === 'processing') statusColor = 'bg-blue-100 text-blue-800'; else if (statusLower === 'delivered') statusColor = 'bg-green-100 text-green-800'; else if (statusLower === 'cancelled') statusColor = 'bg-red-100 text-red-800'; return ` <div class="bg-white border rounded-lg p-4 mb-4 shadow-sm"> <div class="flex flex-col sm:flex-row justify-between items-start mb-3"> <div> <p class="text-xs text-slate-500">Order ID: ${orderId}</p> <p class="font-bold text-lg text-slate-800">Total: Rs. ${(order.totalAmount || 0).toLocaleString('en-US', { minimumFractionDigits: 2 })}</p> </div> <span class="text-sm font-bold px-3 py-1 rounded-full ${statusColor} mt-2 sm:mt-0">${order.status || 'Pending'}</span> </div> <p class="text-sm text-slate-600 mb-2"><strong>Placed On:</strong> ${createdDate}</p> <p class="text-sm text-slate-600 mb-3 break-words"><strong>Items:</strong> ${itemSummary || 'No items found'}</p> <div class="bg-slate-50 p-3 rounded-md"> <p class="text-sm font-semibold text-slate-700">Shipping to: ${order.customerInfo?.name || 'N/A'}</p> <p class="text-xs text-slate-500">${order.customerInfo?.address || 'N/A'}, ${order.customerInfo?.city || ''}</p> </div> </div>`; }).join('');
         } catch (error) {
             console.error("Error fetching orders: ", error);
             trackingItemsContainer.innerHTML = '<p class="text-red-500 text-center">Could not load your orders. Please try again later.</p>';
         }
    };

    // --- Data Loading (for Search & Categories) ---
    const findOfferForProduct = (productId) => { for (const offer of allActiveOffers.values()) { if (offer.productIds && offer.productIds.includes(productId)) { return offer; } } return null; };

    onSnapshot(query(categoriesCol, orderBy("name")), (snapshot) => { 
        categoriesCache = snapshot.docs.map(doc => {
            const data = doc.data();
            const mainImage = data.bannerImageUrl || data.imageUrl; 
            return { 
                 id: doc.id,
                 name: data.name, 
                 imageUrl: mainImage || 'https://via.placeholder.com/300x225?text=No+Image',
                 bannerUrl: data.bannerImageUrl || 'https://via.placeholder.com/1200x400?text=No+Banner'
            };
        }); 
        renderCategorySidebar(categoriesCache); 
    }, error => console.error("Error fetching categories:", error));
    
    onSnapshot(query(offersCol, orderBy("createdAt", "desc")), (snapshot) => {
           allActiveOffers.clear();
           snapshot.forEach(doc => { allActiveOffers.set(doc.id, { id: doc.id, ...doc.data() }); });
       }, error => console.error("Error fetching all offers:", error));

    onSnapshot(query(productsCol, orderBy("createdAt", "desc")), (snapshot) => {
           currentProducts = snapshot.docs.map(doc => {
                const p = { id: doc.id, ...doc.data() };
                return { ...p, price: p.price, originalPrice: p.price, offer: null };
           });
         }, (error) => {
           console.error("Error fetching products: ", error);
           if (searchResultsGrid) searchResultsGrid.innerHTML = '<p class="text-red-500 col-span-full text-center">Error loading products.</p>';
         });

    // --- Category & Search Rendering ---
    const renderProducts = (products, gridElementId) => {
       const gridElement = document.getElementById(gridElementId);
       if (!gridElement) { console.error(`Grid element with ID ${gridElementId} not found.`); return; }
       if (!products || products.length === 0) {
           gridElement.innerHTML = `<p class="text-slate-500 col-span-full text-center py-10">No products found matching your criteria.</p>`;
           return;
        }
       gridElement.innerHTML = products.map(p => {
            let priceHTML = '';
            let offerBadgeHTML = '';
            let currentPrice = p.price;
            let originalPriceForDisplay = p.originalPrice;
            const liveOffer = findOfferForProduct(p.id);
            if (liveOffer && !p.offer) {
                 if (liveOffer.specialPrice) {
                      currentPrice = liveOffer.specialPrice;
                      originalPriceForDisplay = p.price;
                 } else if (liveOffer.percentage) {
                      currentPrice = p.price * (1 - liveOffer.percentage / 100);
                      originalPriceForDisplay = p.price;
                 }
            } else if (p.offer) {
                 currentPrice = p.price;
                 originalPriceForDisplay = p.originalPrice;
            } else {
                 currentPrice = p.price;
                 originalPriceForDisplay = null;
            }
            if (originalPriceForDisplay && originalPriceForDisplay > currentPrice) {
                 priceHTML = `
                      <p class="font-bold text-amber-600 text-lg">Rs. ${currentPrice.toLocaleString('en-US', { minimumFractionDigits: 2 })}</p>
                      <p class="text-sm text-gray-500 line-through">Rs. ${originalPriceForDisplay.toLocaleString('en-US', { minimumFractionDigits: 2 })}</p>
                 `;
                 if (liveOffer && !p.offer){
                      let offerText = liveOffer.percentage ? `${liveOffer.percentage}% OFF` : 'Offer';
                      offerBadgeHTML = `<span class="absolute top-2 right-2 bg-amber-600 text-white text-xs font-bold px-2 py-1 rounded-md uppercase z-10">${offerText}</span>`;
                 } else if (p.offer) {
                      let offerText = p.offer.percentage ? `${p.offer.percentage}% OFF` : 'Offer';
                      offerBadgeHTML = `<span class="absolute top-2 right-2 bg-amber-600 text-white text-xs font-bold px-2 py-1 rounded-md uppercase z-10">${offerText}</span>`;
                 }
            } else {
                 priceHTML = `<p class="font-bold text-amber-600 text-lg">Rs. ${currentPrice.toLocaleString('en-US', { minimumFractionDigits: 2 })}</p>`;
            }
            const installmentPrice3x = (currentPrice / 3).toLocaleString('en-US', { minimumFractionDigits: 2 });
            const installmentPrice4x = (currentPrice / 4).toLocaleString('en-US', { minimumFractionDigits: 2 });
            const descriptionSnippet = p.description ? p.description.substring(0, 70) + (p.description.length > 70 ? '...' : '') : '';

            return `
            <div class="product-card bg-white rounded-lg relative group">
                 ${offerBadgeHTML}
                 <div class="product-image-container">
                      <img src="${p.imageUrl || 'https://placehold.co/300x300?text=No+Image'}" alt="${p.name}" class="product-image" loading="lazy">
                      <div class="action-icons">
                           <a href="cart.html" title="Go to Cart"><i class="fas fa-shopping-cart"></i></a>
                           <button class="search-by-category-btn" data-category="${p.category || 'all'}" title="Search by Category"><i class="fas fa-search"></i></button>
                           <button class="compare-btn" title="Compare"><i class="fas fa-exchange-alt"></i></button>
                           <button class="wishlist-btn" data-product-id="${p.id}" title="Add to Wishlist"><i class="fas fa-heart"></i></button>
                      </div>
                 </div>
                 <div class="product-info-area">
                      <h3 class="product-name font-semibold text-sm text-gray-700">${p.name}</h3>
                      <p class="product-description-snippet">${descriptionSnippet}</p>
                      <div class="price-section">${priceHTML}</div>
                      <div class="installment-info text-xs text-gray-500 mt-1 space-y-1">
                            <p>or 3X <span class="font-semibold text-gray-700">Rs. ${installmentPrice3x}</span> with <span class="font-bold" style="color: #00b8a9;">koko</span> <i class="fas fa-info-circle text-gray-400 text-xs"></i></p>
                            <p>or up to 4X <span class="font-semibold text-gray-700">Rs. ${installmentPrice4x}</span> with <span class="font-bold" style="color: #1ed760;">mintpay</span></p>
                      </div>
                 </div>
            </div>`;
       }).join('');
    };

    const renderCategorySidebar = (categories) => {
           let categoryHTML = `<a href="#" class="category-link" data-category="all">All Products</a>`;
           categoryHTML += categories.map(cat => ` <a href="#" class="category-link flex justify-between items-center" data-category="${cat.name}"> <span>${cat.name}</span> <i class="fas fa-chevron-right text-xs text-gray-400"></i> </a> `).join('');
           
           if (categorySidebarList) {
             categorySidebarList.innerHTML = categoryHTML;
           }
           if (mainMenuCategoryList) {
             mainMenuCategoryList.innerHTML = categoryHTML;
           }

           if(searchCategoryDropdown) {
                let dropdownHTML = `<option value="all">ALL CATEGORIES</option>`;
                dropdownHTML += categories.map(cat => `<option value="${cat.name}">${cat.name.toUpperCase()}</option>`).join('');
                searchCategoryDropdown.innerHTML = dropdownHTML;
           }
    };

    const displaySearchResults = (term, productsToShow, categoryBanner = null, categoryName = null) => {
           mainContentSections.forEach(s => s?.classList.add('hidden'));
           if (categoryName) {
                searchResultsTitle.textContent = `Results for "${categoryName}"`;
           } else {
                searchResultsTitle.textContent = `Search Results for "${term}"`;
           }
           if (categoryBanner) {
                searchCategoryBanner.src = categoryBanner;
                searchCategoryBanner.alt = `${categoryName} Banner`;
                searchCategoryBanner.classList.remove('hidden');
           } else {
                searchCategoryBanner.classList.add('hidden');
           }
           renderProducts(productsToShow, 'search-results-grid');
           searchResultsArea.classList.remove('hidden');
           searchResultsArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
    };

    const hideSearchResults = () => {
           searchResultsArea.classList.add('hidden');
           mainContentSections.forEach(s => s?.classList.remove('hidden'));
    };

    const performSearch = async () => {
           const searchTerm = searchBar.value.trim().toLowerCase();
           const selectedCategory = searchCategoryDropdown.value;

           if (!searchTerm && selectedCategory === 'all') {
                 hideSearchResults();
                 return;
           }
           
           // Redirect to shop.html for search
           let url = 'shop.html?';
           if (searchTerm) url += `search=${encodeURIComponent(searchTerm)}`;
           if (selectedCategory !== 'all') url += `${searchTerm ? '&' : ''}category=${encodeURIComponent(selectedCategory)}`;
           window.location.href = url;
    };
    
    const performDrawerSearch = () => {
        const searchTerm = drawerSearchBar.value;
        if (searchTerm) {
            let url = `shop.html?search=${encodeURIComponent(searchTerm)}`;
            window.location.href = url;
            closeMainMenuDrawer();
        }
    };

    // --- Event Listeners ---
    
    if(searchBar) searchBar.addEventListener('keypress', (e) => {
           if (e.key === 'Enter') {
                performSearch();
           }
    });
    if(searchIconBtn) searchIconBtn.addEventListener('click', performSearch);
    if(searchCategoryDropdown) searchCategoryDropdown.addEventListener('change', performSearch);
    if(drawerSearchBtn) drawerSearchBtn.addEventListener('click', performDrawerSearch);
    if(drawerSearchBar) drawerSearchBar.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            performDrawerSearch();
        }
    });

    const applyCategoryFilter = (e) => {
         const link = e.target.closest('.category-link');
         if (link) {
             e.preventDefault();
             const categoryName = link.dataset.category;
             let url = `shop.html?category=${encodeURIComponent(categoryName)}`;
             window.location.href = url;
             closeMainMenuDrawer();
         }
    };
    if(categorySidebarList) {
          categorySidebarList.addEventListener('click', applyCategoryFilter);
    }
    if(mainMenuCategoryList) {
          mainMenuCategoryList.addEventListener('click', applyCategoryFilter);
    }

    // Product Card Clicks (for search results)
    document.addEventListener('click', async (e) => {
       if (e.target.closest('.wishlist-btn')) {
            const productId = e.target.closest('.wishlist-btn').dataset.productId;
            if (productId) {
                 addToWishlist(productId);
            }
            return;
       }
       if (e.target.closest('.search-by-category-btn')) {
            const category = e.target.closest('.search-by-category-btn').dataset.category;
            if (category) {
                 window.location.href = `shop.html?category=${encodeURIComponent(category)}`;
            }
            return;
       }
       const productCardDiv = e.target.closest('.product-card');
       if (productCardDiv && !e.target.closest('.action-icons button, .action-icons a')) {
             const buttonWithId = productCardDiv.querySelector('[data-product-id]');
             if (buttonWithId) {
                  const productId = buttonWithId.dataset.productId;
                  window.location.href = `product.html?id=${productId}`;
             }
             return;
        }
       if (e.target.closest('#tracking-login-btn')) {
            e.preventDefault();
            if(trackingModal) trackingModal.classList.add('hidden');
            openAccountDrawer();
            return;
       }
    });

    // Logo Clicks
    if (logoBtn) {
         logoBtn.addEventListener('click', (e) => {
                e.preventDefault();
                window.location.href = 'index.html';
         });
    }
    if (mobileLogoBtn) {
         mobileLogoBtn.addEventListener('click', (e) => {
                e.preventDefault();
                window.location.href = 'index.html';
         });
    }

    // --- Initial Load ---
    updateCartCountBadge();
    updateWishlistCountBadge();
    renderCartModal();

</script>

</body>
</html>